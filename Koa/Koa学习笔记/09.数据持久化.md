# 数据持久化

## MySQL

使用 `mysql` 连接数据库。

> [mysql](https://github.com/mysqljs/mysql)

```js
const Koa = require('koa')
const mysql = require('mysql')
const app = new Koa()

// 连接 mysql
const connection = mysql.createConnection({
  host: 'localhost',
  user: 'root',
  password: '123456',
  database: 'koa_demo'
})

// 查询数据库
connection.query('SELECT * FROM user', (err, results, fields) => {
  if (err) throw err

  console.log(results)
})

// 结束连接
connection.end();

app.listen(3000, () => console.log('http server is runing at port 3000'))
```

一般情况下操作数据库是很复杂的读写过程，不只是一个会话，如果直接用会话操作，就需要每次会话都要配置连接参数。

所以这时候就需要连接池管理会话。

```js
const Koa = require('koa')
const mysql = require('mysql')
const app = new Koa()

const pool = mysql.createPool({
  host: 'localhost',
  user: 'root',
  password: '123456',
  database: 'koa_demo'
})

// 在数据池中进行会话操作
pool.getConnection((err, connection) => {
  if (err) throw err

  // 查询数据
  connection.query('SELECT * FROM user', (error, results, fields) => {
    if (error) throw error

    console.log(results)

    // 结束链接
    connection.release();
  })
})

app.listen(3000, () => console.log('http server is runing at port 3000'))
```

## MongoDB
